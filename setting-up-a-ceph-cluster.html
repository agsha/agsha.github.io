<!DOCTYPE html>
<html lang="en">
<head>
          <title>A Pelican Blog</title>
        <meta charset="utf-8" />
        <link href="/feeds/all.atom.xml" type="application/atom+xml" rel="alternate" title="A Pelican Blog Full Atom Feed" />
        <link href="/feeds/misc.atom.xml" type="application/atom+xml" rel="alternate" title="A Pelican Blog Categories Atom Feed" />


    <meta name="tags" content="ceph" />

</head>

<body id="index" class="home">
        <header id="banner" class="body">
                <h1><a href="/">A Pelican Blog <strong></strong></a></h1>
        </header><!-- /#banner -->
        <nav id="menu"><ul>
        </ul></nav><!-- /#menu -->
<section id="content" class="body">
  <header>
    <h2 class="entry-title">
      <a href="/setting-up-a-ceph-cluster.html" rel="bookmark"
         title="Permalink to Setting up a ceph cluster">Setting up a ceph cluster</a></h2>
 
  </header>
  <footer class="post-info">
    <time class="published" datetime="2016-02-07T10:20:00+00:00">
      Sun 07 February 2016
    </time>
    <address class="vcard author">
      By           <a class="url fn" href="/author/sharath-gururaj.html">Sharath Gururaj</a>
    </address>
  </footer><!-- /.post-info -->
  <div class="entry-content">
    <p>The instructions <a href="http://docs.ceph.com/docs/hammer/install/manual-deployment/">here</a> mostly work. Except that the <code>ceph.conf</code> file  given there doesnt work. Because, when I issue <code>sudo /etc/init.d/ceph start mon.node1</code> in the end, It expects a section in <code>ceph.   conf</code> called <code>[mon.node1]</code></p>
<p>Furthermore, to launch a radosgw instance, you <em>need</em> to have a section in your host file called <code>client.rgw.&lt;some_name&gt;</code> and your  keyring should have a corresponding key section called  <code>client.rgw.&lt;some_name&gt;</code> and you should have imported that key into ceph    via <code>sudo ceph auth import -i /etc/ceph/&lt;keyring_file&gt;</code>.</p>
<p><strong>All the three names must match: the one in ceph.conf, in the keyring and in <code>ceph auth list</code></strong></p>
<p>Oh, and yeah, do <strong>NOT</strong> put a line like this in your <code>ceph.conf</code>:</p>
<div class="highlight"><pre>rgw <span class="nv">data</span> <span class="o">=</span> /var/lib/ceph/radosgw/ceph-rgw.prod-d42sa-rgw-a-287004
</pre></div>


<p>If you do, you'l get weird messages like </p>
<blockquote>
<p>Couldn't init storage provider (RADOS)</p>
</blockquote>
<p>and you'll go crazy trying to debug it.</p>
<p>So the working <code>ceph.conf</code> with comments is: </p>
<div class="highlight"><pre><span class="o">[</span>global<span class="o">]</span>
<span class="nv">fsid</span> <span class="o">=</span> a7f64266-0894-4f1e-a635-d0aeaca0e993 <span class="c1">#anything random, generated from uuidgen</span>
auth cluster <span class="nv">required</span> <span class="o">=</span> cephx
auth service <span class="nv">required</span> <span class="o">=</span> cephx
auth client <span class="nv">required</span> <span class="o">=</span> cephx
osd journal <span class="nv">size</span> <span class="o">=</span> 1024
filestore xattr use <span class="nv">omap</span> <span class="o">=</span> <span class="nb">true</span>
osd pool default <span class="nv">size</span> <span class="o">=</span> <span class="m">2</span> 
osd pool default min <span class="nv">size</span> <span class="o">=</span> <span class="m">1</span> 
osd pool default pg <span class="nv">num</span> <span class="o">=</span> <span class="m">333</span> 
osd pool default pgp <span class="nv">num</span> <span class="o">=</span> <span class="m">333</span> 
osd crush chooseleaf <span class="nb">type</span> <span class="o">=</span> <span class="m">1</span> 
<span class="c1"># useful for debugging</span>
<span class="o">[</span>mon<span class="o">]</span>
  debug <span class="nv">mon</span> <span class="o">=</span> 20
<span class="o">[</span>osd<span class="o">]</span>
  debug <span class="nv">osd</span> <span class="o">=</span> 20
<span class="o">[</span>rgw<span class="o">]</span>
  debug <span class="nv">rgw</span><span class="o">=</span>20
<span class="o">[</span>mon.node1<span class="o">]</span> <span class="c1"># as many sections as monitors</span>
  <span class="nv">host</span> <span class="o">=</span> dev-d42sharath1-mon-a-0001-389313 <span class="c1">#This NEEDS to be the actual hostname donno for what reasons</span>
  mon <span class="nv">addr</span> <span class="o">=</span> 10.33.29.199 <span class="c1"># needs to be the actual address.</span>
<span class="o">[</span>client.rgw.foo<span class="o">]</span>
    <span class="nv">host</span> <span class="o">=</span> dev-d42sharath1-rgw-a-0001-389309
    <span class="nv">keyring</span> <span class="o">=</span> /etc/ceph/ceph.client.rgw.keyring
    log <span class="nv">file</span> <span class="o">=</span> /var/log/radosgw/client.radosgw.gateway.log
    rgw <span class="nv">frontends</span> <span class="o">=</span> civetweb <span class="nv">port</span><span class="o">=</span>80
    rgw print <span class="k">continue</span> <span class="o">=</span> <span class="nb">false</span>
</pre></div>
  </div><!-- /.entry-content -->
</section>
        <footer id="contentinfo" class="body">
                <address id="about" class="vcard body">
                Proudly powered by <a href="http://getpelican.com/">Pelican</a>,
                which takes great advantage of <a href="http://python.org">Python</a>.
                </address><!-- /#about -->
        </footer><!-- /#contentinfo -->
</body>
</html>